# AI 互動式 Neo4j 預約系統操作指南

本文件旨在說明您 (人類使用者) 如何透過自然語言與 AI 代理互動，來管理 Neo4j 預約系統。您可以像平常對話一樣提出需求，AI 代理會運用其工具來完成相應的操作。

## 核心互動流程

1.  **您提出需求：** 以自然語言描述您想完成的任務 (例如：「幫我建立一個新的美髮沙龍商家」、「新增一位設計師 John Doe」、「幫客戶預約明天下午兩點的洗剪服務」)。
2.  **AI 理解與回應：** AI 代理會分析您的需求。
    *   如果資訊充足，它會執行相應操作並回報結果 (例如：「商家已建立，ID 是 business_xyz」)。
    *   如果缺少必要資訊，它會向您提問以獲取更多細節 (例如：「好的，請問這個商家的擁有者 User ID 是多少？」)。
3.  **迭代進行：** 您根據 AI 的回饋提供補充資訊或提出下一個步驟，直到完成整個任務。

---

## 場景一：商家初始化

目標：建立一個新的商家，並完成基本設定。

**典型互動範例：**

1.  **您：** 「請幫我建立一個新的商家，名稱是『陽光咖啡廳』，類型是『咖啡廳』，地址在『測試市中山路 100 號』，電話『02-11112222』，Email『sunny@cafe.test』，描述是『提供手沖咖啡與輕食』，預約模式先用『TimeOnly』。」
    *   **AI 代理：** (可能需要確認擁有者) 「好的，請問這個商家的擁有者 User ID 是多少？」
    *   **您：** (若不知 User ID) 「我不確定，擁有者的 External ID 是 `owner_external_123`，可以幫我查一下嗎？」
    *   **AI 代理：** 「查詢到擁有者的 User ID 是 `user_abc`。現在為您建立商家。」 (稍後) 「商家『陽光咖啡廳』已建立，Business ID 是 `business_xyz`。」

2.  **您：** 「商家 `business_xyz` 建立好了，現在幫我設定營業時間，週一到週五早上 9 點到晚上 6 點。」
    *   **AI 代理：** 「好的，正在為商家 `business_xyz` 設定營業時間...」 (稍後) 「營業時間已設定完成。」
    *   **(進階：設定分段營業時間)** 您也可以設定分段時間，例如：「幫商家 `business_xyz` 設定週一營業時間為 9:00-12:00 和 14:00-18:00。」AI 代理會為同一天建立多筆記錄。

3.  **您：** 「請幫商家 `business_xyz` 新增一個服務項目，名稱是『手沖單品咖啡』，時長 30 分鐘，描述『嚴選咖啡豆』，價格 150 元。」
    *   **AI 代理：** 「好的，正在新增服務項目...」 (稍後) 「服務『手沖單品咖啡』已新增，Service ID 是 `service_abc`。」

4.  **您：** (如果需要資源) 「我們需要管理座位，請幫商家 `business_xyz` 建立一個資源類型，名稱是『吧檯座位』，總容量 5 個，描述『靠近咖啡師的座位』。」
    *   **AI 代理：** 「好的，正在建立資源類型...」 (稍後) 「資源類型『吧檯座位』已建立。」

5.  **您：** 「檢查一下商家 `business_xyz` 的設定是否都完整了？」
    *   **AI 代理：** 「正在檢查商家 `business_xyz` 的設定...」 (稍後) 「檢查結果：營業時間缺少週六日的設定，員工尚未設定，其他項目已完成。」

---

## 場景二：員工初始化

目標：為指定商家新增一位員工，並設定其基本資料、可提供的服務及可用時間。

**典型互動範例：**

1.  **您：** 「幫商家 `business_xyz` 新增一位員工，姓名是『王大明』，Email『david@cafe.test』。」
    *   **AI 代理：** 「好的，正在新增員工...」 (稍後) 「員工『王大明』已新增，Staff ID 是 `staff_123`。」

2.  **您：** 「讓員工 `staff_123` 可以提供『手沖單品咖啡』這項服務 (Service ID 是 `service_abc`)。」
    *   **AI 代理：** 「好的，正在將員工 `staff_123` 與服務 `service_abc` 關聯...」 (稍後) 「關聯已完成。」

3.  **您：** 「設定員工 `staff_123` 的可用時間，週一、週三、週五的下午 1 點到晚上 6 點。」
    *   **AI 代理：** 「好的，正在設定員工 `staff_123` 的可用時間...」 (稍後) 「可用時間已設定完成。」
    *   **(進階：設定分段工時)** 您也可以設定分段工時，例如：「幫員工 `staff_123` 設定週三工時為 9:00-12:00 和 13:00-18:00。」AI 代理會為同一天建立多筆記錄。

4.  **您：** (可選) 「將員工 `staff_123` 關聯到他的用戶帳號，用戶 ID 是 `user_david`。」
    *   **AI 代理：** 「好的，正在關聯員工與用戶帳號...」 (稍後) 「關聯已完成。」

---

## 場景三：用戶預約

目標：代表客戶完成一個服務預約。

**典型互動範例：**

1.  **您：** 「客戶陳小姐想預約『陽光咖啡廳』(Business ID: `business_xyz`) 的『手沖單品咖啡』(Service ID: `service_abc`)，時間是下週一 (假設是 2025-05-05) 下午 3 點，指定由『王大明』(Staff ID: `staff_123`) 服務。」
    *   **AI 代理：** (可能需要確認客戶) 「好的，請問客戶陳小姐的 Customer ID 是多少？或者她的用戶 External ID 是多少？」
    *   **您：** 「她的 External ID 是 `customer_external_456`。」
    *   **AI 代理：** 「查詢到客戶陳小姐的 Customer ID 是 `customer_def`。正在檢查該時段是否可預約...」 (稍後) 「確認該時段員工和服務皆可預約。」
    *   **您：** 「好的，請建立預約，備註：需要無糖。」
    *   **AI 代理：** 「好的，正在建立預約...」 (稍後) 「預約已建立成功，Booking ID 是 `booking_789`。」

---

## 補充：處理員工請假與不規律排班

除了設定固定的每週可用時間 (`SCHEDULE`)，您也可以使用 `EXCEPTION` 來處理特定日期的特殊情況。

**重要概念：**

*   **`EXCEPTION` 優先：** 如果某一天同時設定了 `SCHEDULE` 和 `EXCEPTION`，系統會**完全以 `EXCEPTION` 的設定為準**，忽略當天的 `SCHEDULE`。
*   **`EXCEPTION` 定義實際可用時間：** `EXCEPTION` 用於定義某個**特定日期**的**實際可用時間段**。

**應用場景：**

1.  **設定特定日期的特殊上班時間 (例如：調班、加班、早晚班輪調)：**
    *   **方法：** 告知 AI 代理員工在哪一天需要設定特殊的上班時間。
    *   **互動範例：**
        *   **您：** 「幫員工 `staff_123` 設定 5 月 12 日改上晚班 14:00-22:00。」
        *   **AI 代理：** 「好的，正在為員工 `staff_123` 設定 2025-05-12 的上班時間為 14:00-22:00...」 (稍後) 「設定完成。」
    *   **說明：** AI 代理會使用 `EXCEPTION` 功能，將該員工在 5 月 12 日的可用時間設定為 14:00 到 22:00。

2.  **設定休息日/請假日：**
    *   **方法：** 告知 AI 代理員工在哪一天需要休息或請假。
    *   **互動範例：**
        *   **您：** 「員工 `staff_123` 在 5 月 10 日休息。」
    *   **AI 代理：** 「好的，正在為員工 `staff_123` 設定 2025-05-10 為休息日...」 (稍後) 「設定完成。」
    *   **說明：** AI 代理會確保該員工在指定日期**沒有**任何可用的 `EXCEPTION` 或 `SCHEDULE` 記錄。最常見的做法是為該日設定一個非常短 (幾乎不可用) 的 `EXCEPTION`，例如 `00:00` 到 `00:01`，或者確保設定操作會清除當天所有舊記錄且不創建新記錄。

3.  **處理不規律的每月排班 (例如：輪休、無固定週循環)：**
    *   **方法 (推薦)：** 完全使用 `EXCEPTION` 來定義每個月的班表。
    *   **步驟：**
        1.  不要為這些員工設定固定的每週 `SCHEDULE`。
        2.  當每個月的班表確定後，為該員工在這個月中的**每一個「上班日」**，都透過 AI 代理設定一筆 `EXCEPTION` 記錄，明確指定當天的上班 `start_time` 和 `end_time`。
        3.  對於「休息日」，則**不需要**設定任何 `EXCEPTION` 記錄。
    *   **互動範例：**
        *   **您：** 「這是員工 `staff_123` 五月份的班表：5/1 早班 9-18, 5/2 早班 9-18, 5/3 休息, 5/4 晚班 14-22, 5/5 休息... 請幫我設定。」
        *   **AI 代理：** (會為 5/1, 5/2, 5/4 等上班日分別設定 `EXCEPTION`，並確保 5/3, 5/5 沒有可用記錄) 「好的，正在設定五月份班表...」 (稍後) 「設定完成。」
    *   **說明：** 透過為每個上班日設定 `EXCEPTION`，您可以精確地定義員工在該月的實際工作時間。

---

## 重要提示與已知限制

*   **提供明確資訊：** 您提供的資訊越明確 (例如直接提供 ID 而不是名稱)，AI 代理處理起來越快越準確。
*   **處理 ID：** AI 代理在創建記錄後會回報 ID (例如 Business ID, Staff ID, Booking ID)。請記錄這些 ID，因為後續的操作 (更新、刪除、關聯) 通常需要使用它們。
*   **錯誤處理：** 如果操作失敗，AI 代理會回報錯誤訊息。您可以根據錯誤訊息提供修正後的資訊，或指示 AI 代理重試 (特別是遇到超時或暫時性連接錯誤時)。
*   **迭代確認：** 對於複雜流程，可以分步進行，每一步都向 AI 確認結果，確保一切按預期進行。
*   **分段時間設定：**
    *   您可以為**商家營業時間**或員工的**固定週班表 (`SCHEDULE`)** 設定同一天的多分段時間 (例如 9-12, 14-18)。設定工具 (`Neo4jSetBusinessHours`, `Neo4jSetStaffAvailability`) 已修正此功能。
*   **查找可用時段的限制：**
    *   查找可用時段的工具 (`Neo4j_Find_Available_Slots_*`) **可以**正確處理分段的**員工可用性 (`StaffAvailability`)**。
    *   **已知問題：** 查找可用時段的工具在處理分段的**商家營業時間 (`BusinessHours`)** 時可能存在問題，無法返回所有預期的可用時段 (特別是在 `StaffOnly` 或 `StaffAndResource` 模式下)。**建議：** 盡量避免設定分段的商家營業時間，或只設定包含所有可能預約時段的單一最大範圍。如果必須設定分段營業時間，建議使用 `TimeOnly` 模式查找可用時段，然後再另外確認員工是否有空。

透過這種自然語言互動的方式，您可以更輕鬆地管理預約系統的資料。
