# Neo4j 預約系統使用手冊

本手冊分為兩部分：

1.  **商家啟動指南**：引導商家完成系統的初始設定，以便順利開始營運。
2.  **用戶使用者指南**：為使用預約系統的終端顧客提供簡單易懂的操作說明。

---

## 商家啟動指南 (Business Onboarding Guide)

歡迎使用 Neo4j 預約系統！為了讓您的業務順利上線並開始接受預約，請依照以下步驟完成設定。這些設定通常會透過 n8n 工作流程中的特定節點來完成。

**核心概念：**

*   **用戶 (User)**：系統中的任何人，包括商家擁有者、員工和顧客，都需要一個用戶帳號來識別身份。
*   **商家 (Business)**：您的店舖或公司實體，包含基本資訊、營業時間等。
*   **服務 (Service)**：您提供給顧客的具體服務項目，例如「剪髮」、「諮詢」、「場地租借」。
*   **員工 (Staff)**：提供服務的員工。員工可以關聯到用戶帳號，並設定可提供服務和工作時間。
*   **資源 (Resource)**：預約時可能需要佔用的實體資源，例如「會議室 A」、「美容床 2 號」、「靠窗座位」。(如果您的預約模式需要考慮資源的話)
*   **客戶 (Customer)**：在您的商家註冊並使用服務的顧客記錄。客戶記錄會關聯到他們的用戶帳號。
*   **預約 (Booking)**：顧客預訂特定時間、服務、員工或資源的記錄。

**設定步驟：**

1.  **建立您的管理者帳號 (如果尚未建立)**
    *   **目的**：作為商家擁有者，您需要一個系統帳號。
    *   **對應節點**：`Neo4j: Create User`
    *   **操作**：提供您的姓名、Email、電話號碼等資訊來建立用戶帳號。記下產生的 `userId`，後續步驟會用到。

2.  **建立您的商家資料**
    *   **目的**：在系統中註冊您的商家。
    *   **對應節點**：`Neo4j: Create Business`
    *   **操作**：
        *   提供上一步建立的管理者 `userId` (作為 `ownerUserId`)。
        *   填寫商家名稱、類型 (例如：美髮沙龍、診所、餐廳)、地址、電話、Email、商家簡介。
        *   選擇 `booking_mode` (預約檢查模式)：
            *   `ResourceOnly`：預約只檢查資源是否可用。
            *   `StaffOnly`：預約只檢查員工是否有空。
            *   `StaffAndResource`：預約需同時檢查員工和資源是否都可用。
            *   `TimeOnly`：預約只檢查該時段是否在營業時間內，不檢查特定員工或資源。
    *   記下產生的 `businessId`。

3.  **設定商家營業時間**
    *   **目的**：定義商家每週的開放時段。
    *   **對應節點**：`Neo4j: Set Business Hours`
    *   **操作**：
        *   提供您的 `businessId`。
        *   提供一個包含每天營業時間的列表 (JSON 格式)。例如：`[{"day_of_week": 1, "start_time": "09:00", "end_time": "18:00"}, {"day_of_week": 2, ...}]` (星期一為 1，星期日為 7，時間使用 24 小時制 UTC 時間)。如果某天休息，則不要包含該天的記錄。
        *   **注意**：此操作會覆蓋之前的設定。

4.  **建立服務項目**
    *   **目的**：定義您提供給顧客的服務。
    *   **對應節點**：`Neo4j: Create Service`
    *   **操作**：
        *   提供您的 `businessId`。
        *   填寫服務名稱 (例如：洗剪吹、基礎保養)、服務所需時間 (分鐘)、服務描述、價格 (可選)。
        *   您可以重複此步驟建立多個不同的服務項目。

5.  **建立員工資料 (如果適用)**
    *   **目的**：管理您的員工以及他們能提供的服務和工作時間。
    *   **步驟**：
        *   **(a) 為員工建立用戶帳號 (如果員工需要登入或接收通知)**：使用 `Neo4j: Create User`，提供員工的姓名、Email、電話等。記下員工的 `userId`。
        *   **(b) 建立員工記錄**：使用 `Neo4j: Create Staff`，提供您的 `businessId` 和員工姓名。記下產生的 `staffId`。
        *   **(c) 關聯員工記錄與用戶帳號 (如果執行了 a 步驟)**：使用 `Neo4j: Link Staff to User`，提供 `staffId` 和員工的 `userId`。
        *   **(d) 指定員工可提供的服務**：使用 `Neo4j: Link Staff to Service`，提供 `staffId` 和該員工能提供的 `serviceId`。一個員工可以關聯多個服務。
        *   **(e) 設定員工個人可預約時段**：使用 `Neo4j: Set Staff Availability`，提供 `staffId` 和該員工每週可接受預約的時段 (格式類似設定商家營業時間，但針對特定員工)。這會覆蓋員工之前的設定。

6.  **建立資源資料 (如果適用)**
    *   **目的**：管理預約時需要考慮的實體資源 (例如：房間、設備)。僅當您的 `booking_mode` 包含資源時需要設定。
    *   **對應節點**：`Neo4j: Create Resource`
    *   **操作**：
        *   提供您的 `businessId`。
        *   填寫資源類型 (例如：會議室、診療床、包廂)、資源名稱/編號 (例如：A 會議室、3 號床、VIP 包廂)、容量 (可選)、其他屬性 (可選，JSON 格式)。
        *   您可以重複此步驟建立多個資源。
        *   **提示**：可以使用 `Neo4j: List Resource Types` 查詢目前已有的資源類型，方便統一管理。

7.  **管理客戶資料 (通常由系統自動處理)**
    *   **目的**：記錄曾在您商家消費或預約的顧客資訊。
    *   **流程說明**：當顧客首次透過某個管道 (例如 Line Bot) 與您的商家互動時，系統通常會：
        *   使用 `Neo4j: Find User by External ID` 檢查顧客是否已有系統帳號。
        *   如果沒有，使用 `Neo4j: Create User` 為顧客建立帳號。
        *   使用 `Neo4j: Find Customer by External ID & Business ID` 檢查該顧客是否已是您商家的客戶。
        *   如果不是，使用 `Neo4j: Create Customer` 將顧客的用戶帳號與您的商家關聯，建立客戶記錄。
    *   **手動操作**：您也可以在後台使用 `Neo4j: Create Customer` 手動為已知用戶建立客戶記錄。後續可使用 `Neo4j: Update Customer` 更新客戶資料，或 `Neo4j: Delete Customer` 刪除記錄。

**完成以上步驟後，您的系統基礎設定就緒，可以開始接受和管理預約了！** 您可以使用以下節點來管理日常營運：

*   `Neo4j: Find Available Slots`：查找指定服務在特定日期範圍內的可用預約時段。
*   `Neo4j: Create Booking`：為客戶建立新的預約。
*   `Neo4j: Update Booking`：修改現有預約的資訊 (例如：更改時間、狀態)。
*   `Neo4j: Delete Booking`：取消預約。
*   以及其他更新/刪除商家、服務、員工、資源等資訊的節點。

---

## 用戶使用者指南 (End-User Guide)

您好！歡迎使用我們的線上預約服務。透過這個系統，您可以輕鬆找到您需要的服務並完成預約。以下是簡單的操作步驟：

1.  **尋找您想預約的店家**
    *   您可以透過搜尋功能，輸入店家的名稱關鍵字來找到他們。

2.  **瀏覽店家提供的服務項目**
    *   找到店家後，您可以查看他們提供的所有服務列表，了解服務內容、所需時間和價格等資訊。

3.  **選擇服務並查看可預約的時間**
    *   選擇您感興趣的服務後，系統會讓您選擇想要預約的日期範圍。
    *   接著，系統會顯示出在您選擇的日期範圍內，該服務還有哪些可以預約的時段。
    *   (依店家設定) 有時候，您可能還需要或可以選擇想要指定的服務人員 (員工) 或使用的特定設施 (資源)。

4.  **確認並送出預約**
    *   從可預約的時段中選擇一個您方便的時間。
    *   確認預約的店家、服務、時間、(可能還有) 服務人員或資源都正確無誤。
    *   您可能需要填寫一些基本聯絡資訊或備註。
    *   確認送出後，您的預約就完成了！您通常會收到一個預約成功的通知。

5.  **管理您的預約**
    *   如果您需要查看、修改或取消您的預約，通常可以在系統的「我的預約」或類似區域進行管理。
    *   **查看**：列出您所有即將到來或過去的預約紀錄。
    *   **修改**：如果行程有變，您或許可以在允許的時間內更改預約時間或其他細節 (視店家規定)。
    *   **取消**：如果您無法前往，請盡早取消預約，以便店家安排。

**就這麼簡單！希望您能享受便利的預約體驗。**
